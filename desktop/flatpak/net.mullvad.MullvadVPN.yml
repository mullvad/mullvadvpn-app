id: net.mullvad.MullvadVPN
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '25.08'
command: '/app/Mullvad VPN/mullvad-gui'
modules:
  - name: hello
    buildsystem: simple
    sources:
      # - type: script
      #   dest-filename: hello.sh
      #   commands:
      #     - echo "Hello world, from a sandbox"
      - type: file
        path: ./net.mullvad.MullvadVPN.desktop
      # - type: file
      #   url: https://releases.mullvad.net/desktop/releases/2025.14/MullvadVPN-2025.14_amd64.deb
      #   dest-filename: MullvadVPN.deb
      #   sha256: 247b981e2e2e047ccca296b8e62a70b1dc7fdcec7f17137795884100240e0a41
      - type: file
        path: ./MullvadVPN-2025.14-dev-f2b240_amd64.deb
        dest-filename: MullvadVPN.deb
    build-commands:
      - ar x MullvadVPN.deb # extract data.tar.xz from .deb
      - tar -xvf data.tar.xz

      # CLIs
      - install -Dm755 usr/bin/mullvad                                    /app/bin/
      # TODO mullvad-problem-report collect is curretly broken
      - install -Dm755 "opt/Mullvad VPN/resources/mullvad-problem-report" /app/bin/

      # Desktop entry
      - install -Dm644 net.mullvad.MullvadVPN.desktop /app/share/applications/net.mullvad.MullvadVPN.desktop

      # Icons (max size is 512x512)
      - install -Dm644 usr/share/icons/hicolor/16x16/apps/mullvad-vpn.png   /app/share/icons/hicolor/16x16/net.mullvad.MullvadVPN.png
      - install -Dm644 usr/share/icons/hicolor/32x32/apps/mullvad-vpn.png   /app/share/icons/hicolor/32x32/net.mullvad.MullvadVPN.png
      - install -Dm644 usr/share/icons/hicolor/48x48/apps/mullvad-vpn.png   /app/share/icons/hicolor/48x48/net.mullvad.MullvadVPN.png
      - install -Dm644 usr/share/icons/hicolor/64x64/apps/mullvad-vpn.png   /app/share/icons/hicolor/64x64/net.mullvad.MullvadVPN.png
      - install -Dm644 usr/share/icons/hicolor/128x128/apps/mullvad-vpn.png /app/share/icons/hicolor/128x128/net.mullvad.MullvadVPN.png
      - install -Dm644 usr/share/icons/hicolor/256x256/apps/mullvad-vpn.png /app/share/icons/hicolor/256x256/net.mullvad.MullvadVPN.png
      - install -Dm644 usr/share/icons/hicolor/512x512/apps/mullvad-vpn.png /app/share/icons/hicolor/512x512/net.mullvad.MullvadVPN.png

      # Rest of the owl
      - mv "opt/Mullvad VPN" /app/

finish-args:
  # X11 + XShm access
  # - --share=ipc
  # - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # GPU acceleration if needed
  - --device=dri
  # Needs to talk to the network:
  - --share=network
  # Needs to save files locally
  - --filesystem=xdg-documents

  # Full dbus access
  # TODO: limit this
  - --socket=system-bus
  # Mullvad gRPC socket
  - --filesystem=/run/mullvad-vpn

